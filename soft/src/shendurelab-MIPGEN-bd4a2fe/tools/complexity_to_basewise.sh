# arg1, arg2= mipwise and complexity files
# arg3, coverage threshold
# prints the proportion of bases above the given threshold
awk 'FNR==1 {next} FILENAME~"mipwise" {split($2,mipf,"/"); split(mipf[1],chrf,":"); split(chrf[2],range,"-");split(mipf[2],armf,",");if(mipf[3]=="+") {for((i=range[1] + armf[1]); i<=(range[2] - armf[2]);i++) {target[chrf[1],i]=0}} else {for(i=(range[1] + armf[2]); i<= (range[2] - armf[1]);i++) {target[chrf[1],i]=0}}} FILENAME~"complexity" {samples[$1]=1; split($2,mipf,"/"); split(mipf[1],chrf,":"); split(chrf[2],range,"-");split(mipf[2],armf,",");if(mipf[3]=="+") {for(i=(range[1] + armf[1]); i<=(range[2] - armf[2]);i++) {ucov[$1,chrf[1],i]+=$4}} else {for(i=(range[1]+armf[2]); i<= (range[2] - armf[1]);i++) {ucov[$1,chrf[1],i]+=$4}}} END {for (s in samples) { for (t in target) { split(t,t2,SUBSEP); if(!((s,t2[1],t2[2]) in ucov)) {ucov[s,t2[1],t2[2]]=0}}} for (k in ucov) {split(k,out,SUBSEP); print out[1] "\t" out[2] "\t" out[3] "\t" ucov[k]}}' $1 $2 | awk -v thresh=$3 '$4 >= thresh {p++} {t++} END {print p / t}'
